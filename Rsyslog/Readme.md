
## SELinux

```bash
#Проверяем, работает ли в нашей системе SELinux:
getenforce
#Если мы получаем в ответ:
enforcing
#Тогда необходимо либо настроить SELinux:
semanage port -m -t syslogd_port_t -p tcp 514
semanage port -m -t syslogd_port_t -p udp 514
#либо отключить его командами:
setenforce 0
sed -i 's/^SELINUX=.*/SELINUX=disabled/g' /etc/selinux/config
```

# Настройка сервера
## Установка Сервера сбора логов на первом сервере (к примеру на HQ)

```bash
sudo apt-get install -y rsyslog
#Открываем конфигурационный файл:
sudo nano /etc/rsyslog.conf

#Снимаем комментарии со следующих строк:
module(load="imudp")
input(type="imudp" port="514")
# provides TCP syslog reception
module(load="imtcp")
input(type="imtcp" port="514")

#* в данном примере мы разрешили запуск сервера для соединений TCP и UDP на портах 514. На самом деле, можно оставить только один протокол, например, более безопасный и медленный TCP.
```

```bash
#После добавляем в конфигурационный файл строки:
$template RemoteLogs,"/var/log/rsyslog/%HOSTNAME%/%PROGRAMNAME%.log"
*.* ?RemoteLogs
& ~

#в данном примере мы создаем шаблон с названием RemoteLogs, который принимает логи всех категорий, любого уровня (про категории и уровни читайте ниже); логи, полученный по данному шаблону будут сохраняться в каталоге по маске /var/log/rsyslog/<имя компьютера, откуда пришел лог>/<приложение, чей лог пришел>.log; конструкция & ~ говорит о том, что после получения лога, необходимо остановить дальнейшую его обработку.
```

```bash
#Перезапускаем службу логов:
sudo systemctl restart rsyslog
```

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
# Настройка клиента ПЕРЕХОДИМ БЛЯТЬ НА ДРУГОЙ СЕРВЕР  !
## Устанавливаем rsyslog и настраиваем его            !
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!



```bash
sudo apt-get install -y rsyslog
#Открываем конфигурационный файл:
sudo nano /etc/rsyslog.conf

#Снимаем комментарии со следующих строк:
module(load="imudp")
input(type="imudp" port="514")
# provides TCP syslog reception
module(load="imtcp")
input(type="imtcp" port="514")

#в данном примере мы разрешили запуск сервера для соединений TCP и UDP на портах 514. На самом деле, можно оставить только один протокол, например, более безопасный и медленный TCP.
```

```bash
#Для начала можно настроить отправку всех логов на сервер. Создаем конфигурационный файл для rsyslog:
sudo nano /etc/rsyslog.d/all.conf
#Добавляем:
*.* @@<ip address>:514
# ГАЛОЧКИ УБИРАЕМ ТОЖЕ
# где ip address это адрес сервера rsyslog
#Перезапускаем rsyslog на клиенте
sudo systemctl restart rsyslog
```

# Проверка + показываю, что работает (сделать скрины и подписать, что вот такие команды ввожу и получаю результат)

```bash
ls /var/log/rsyslog/
# вывод должен быть примерно таким
# и в каждой папке есть логи каждого сервера
server-br  server-hq
```



